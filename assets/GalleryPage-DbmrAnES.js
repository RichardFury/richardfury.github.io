import{i as x}from"./waterfall-IAql_oPo.js";import{_ as G,r as p,c as O,o as S,a as E,w as L,b as d,f as b,h as g,i as V,T,j as C,d as m,e as o,k as h,t as f,l as D,F as $,m as A}from"./index-Bzm2Dpwr.js";class P{constructor(s,a,t,r,l={}){this.id=s,this.path=a,this.description=t,this.tags=r,this.camera=l.camera||null,this.aperture=l.aperture||null,this.shutterSpeed=l.shutterSpeed||null,this.iso=l.iso||null,this.focalLength=l.focalLength||null}}const R=[{id:"1",url:"/assets/fig/photo-light.JPG",title:"山间日出",tags:["风景","自然"],cameraParams:{camera:"Canon EOS R5",aperture:"f/2.8",shutterSpeed:"1/125s",iso:"100",focalLength:"24mm"}},{id:"2",url:"/assets/fig/photo-dark.JPG",title:"城市夜景",tags:["夜景","城市"],cameraParams:{camera:"Sony A7R IV",aperture:"f/4.0",shutterSpeed:"10s",iso:"1600",focalLength:"28mm"}},{id:"3",url:"/assets/fig/photo-light.JPG",title:"古老建筑",tags:["旅行","建筑"],cameraParams:{camera:"Nikon Z7 II",aperture:"f/5.6",shutterSpeed:"1/60s",iso:"400",focalLength:"35mm"}},{id:"4",url:"/assets/fig/photo-dark.JPG",title:"传统美食",tags:["美食","文化"],cameraParams:{camera:"Fujifilm X-T4",aperture:"f/2.0",shutterSpeed:"1/100s",iso:"200",focalLength:"50mm"}},{id:"5",url:"/assets/fig/photo-light.JPG",title:"人像摄影",tags:["人像","生活"],cameraParams:{camera:"Canon EOS R6",aperture:"f/1.8",shutterSpeed:"1/250s",iso:"100",focalLength:"85mm"}},{id:"6",url:"/assets/fig/photo-dark.JPG",title:"星空摄影",tags:["夜景","自然"],cameraParams:{camera:"Sony A7S III",aperture:"f/2.8",shutterSpeed:"20s",iso:"6400",focalLength:"14mm"}}],M="YOUR_GOOGLE_API_KEY",F="YOUR_GOOGLE_DRIVE_FOLDER_ID";async function B(){return window.gapi||await new Promise((e,s)=>{const a=document.createElement("script");a.src="https://apis.google.com/js/api.js",a.onload=e,a.onerror=s,document.head.appendChild(a)}),new Promise((e,s)=>{window.gapi.load("client",async()=>{try{await window.gapi.client.init({apiKey:M,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),e()}catch(a){s(a)}})})}async function J(){try{await B();const s=(await window.gapi.client.drive.files.list({q:`'${F}' in parents and mimeType contains 'image/' and trashed = false`,fields:"files(id, name, description, mimeType, modifiedTime)",orderBy:"modifiedTime desc",pageSize:100})).result.files;return await Promise.all(s.map(async a=>{const t=`https://drive.google.com/uc?id=${a.id}&export=view`,r=a.description||a.name.replace(/\.[^/.]+$/,""),l=N(a.name);return new P(a.id,t,r,l)}))}catch(e){return console.error("Error fetching images from Google Drive:",e),k()}}function N(e){const s=e.split("_");if(s.length>1){const a=s[s.length-1],t=a.lastIndexOf(".");return t>0&&(s[s.length-1]=a.substring(0,t)),s.slice(1)}return[]}function k(){return R.map(e=>new P(e.id,e.url,e.title,e.tags,e.cameraParams))}const U=async()=>{try{const e=await J();return e&&e.length>0?e:k()}catch(e){return console.error("Error in getGalleryImages:",e),k()}},j={class:"modal-layout"},q={class:"photo-section"},K=["src","alt"],Y={key:0,class:"loading-indicator"},W={class:"info-section"},z={class:"info-scroll-wrapper"},X={class:"title-area"},Z={class:"photo-title"},H={key:0,class:"image-index"},Q={class:"content-area"},ee={class:"photo-description"},ae={class:"camera-area"},te={class:"camera-params-list"},se={__name:"ImageModal",props:{modelValue:{type:Boolean,default:!1},image:{type:Object,required:!0},images:{type:Array,default:()=>[]}},emits:["update:modelValue","close","update:image"],setup(e,{emit:s}){const a={props:{label:{type:String,required:!0},value:{type:String,default:null}},template:`
    <div class="camera-param">
      <span class="param-label">{{ label }}:</span>
      <span class="param-value">{{ value || '未知' }}</span>
    </div>
  `},t=e,r=s,l=p(!1),u=O(()=>t.images.findIndex(i=>i.id===t.image.id)),y=()=>{v()},v=()=>{r("update:modelValue",!1),r("close")},w=()=>{if(t.images.length<=1)return;l.value=!0;const i=u.value===0?t.images.length-1:u.value-1;r("update:image",t.images[i])},_=()=>{if(t.images.length<=1)return;l.value=!0;const i=(u.value+1)%t.images.length;r("update:image",t.images[i])},I=()=>{l.value=!1},c=i=>{switch(["ArrowLeft","ArrowRight","Escape"].includes(i.key)&&i.preventDefault(),i.key){case"Escape":v();break;case"ArrowLeft":w();break;case"ArrowRight":_();break}};return S(()=>{t.modelValue&&document.addEventListener("keydown",c)}),E(()=>{document.removeEventListener("keydown",c),document.body.style.overflow=""}),L(()=>t.modelValue,i=>{i?(document.body.style.overflow="hidden",document.addEventListener("keydown",c),setTimeout(()=>{const n=document.querySelector(".modal-overlay");n&&n.focus()},100)):(document.body.style.overflow="",document.removeEventListener("keydown",c))}),L(()=>t.image,()=>{l.value=!0}),(i,n)=>(d(),b(C,{to:"body"},[g(T,{name:"modal"},{default:V(()=>[e.modelValue?(d(),m("div",{key:0,class:"modal-overlay",onClick:y},[o("div",{class:"modal-content",onClick:n[0]||(n[0]=D(()=>{},["stop"]))},[o("div",j,[o("div",q,[o("img",{src:e.image.path,alt:e.image.description,class:"modal-photo",onLoad:I},null,40,K),l.value?(d(),m("div",Y,n[1]||(n[1]=[o("div",{class:"spinner"},null,-1)]))):h("",!0)]),o("div",W,[o("div",z,[o("div",X,[o("h3",Z,f(e.image.description||"未命名照片"),1),e.images.length>1?(d(),m("div",H,f(u.value+1)+" / "+f(e.images.length),1)):h("",!0)]),o("div",Q,[o("p",ee,f(e.image.description||"暂无描述"),1)]),o("div",ae,[n[2]||(n[2]=o("h4",{class:"camera-title"},"相机参数",-1)),o("div",te,[g(a,{label:"相机",value:e.image.camera},null,8,["value"]),g(a,{label:"光圈",value:e.image.aperture},null,8,["value"]),g(a,{label:"快门",value:e.image.shutterSpeed},null,8,["value"]),g(a,{label:"ISO",value:e.image.iso},null,8,["value"]),g(a,{label:"焦距",value:e.image.focalLength},null,8,["value"])])])])])])])])):h("",!0)]),_:1})]))}},le=G(se,[["__scopeId","data-v-369b9cf8"]]),oe={class:"gallery-container"},ie={id:"waterfall-container"},ne=["onClick"],re={class:"image-wrapper"},ce=["src","alt"],de={key:0,class:"loading"},ue={__name:"GalleryPage",setup(e){const s=p([]),a=p(!0),t=p(null),r=p(!1);let l=null,u=0;const y=()=>{u++,u===s.value.length&&(v(),a.value=!1)},v=()=>{l&&l.destroy(),l=x("#waterfall-container",".gallery-item")},w=c=>{t.value=c,r.value=!0},_=()=>{t.value=null},I=c=>{t.value=c};return S(async()=>{try{a.value=!0,u=0,s.value=await U(),s.value.length===0&&setTimeout(()=>{a.value=!1},1e3)}catch(c){console.error("Error loading gallery:",c),a.value=!1}}),E(()=>{l&&(l.destroy(),l=null),document.body.style.overflow=""}),(c,i)=>(d(),m("div",oe,[i[1]||(i[1]=o("h1",null,"Gallery",-1)),o("div",ie,[(d(!0),m($,null,A(s.value,n=>(d(),m("div",{key:n.id,class:"gallery-item",onClick:me=>w(n)},[o("div",re,[o("img",{src:n.path,alt:n.description,class:"gallery-image",onLoad:y},null,40,ce)])],8,ne))),128)),a.value?(d(),m("div",de,"加载中...")):h("",!0)]),t.value?(d(),b(le,{key:0,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=n=>r.value=n),image:t.value,images:s.value,onClose:_,"onUpdate:image":I},null,8,["modelValue","image","images"])):h("",!0)]))}},he=G(ue,[["__scopeId","data-v-de5c98d3"]]);export{he as default};
