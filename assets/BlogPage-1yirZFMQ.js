import{_ as C,b as u,d as m,e as o,F as f,m as $,t as _,k,r as g,c as y,s as B,q as P,v as D,u as x,o as I,h as w}from"./index-Bzm2Dpwr.js";const L={class:"sidebar"},j={class:"sidebar-content"},M=["onClick"],O={__name:"ArticleListComponent",props:{posts:{type:Array,required:!0}},setup(a){return(c,e)=>(u(),m("div",L,[e[0]||(e[0]=o("div",{class:"sidebar-header"},"Articles",-1)),o("div",j,[(u(!0),m(f,null,$(a.posts,r=>(u(),m("div",{key:r.id,class:"sidebar-item",onClick:t=>c.$emit("selectPost",r.id)},_(r.title),9,M))),128))])]))}},T=C(O,[["__scopeId","data-v-7a7b0599"]]),q={class:"content"},E={class:"thought-list"},V={class:"post-header"},F=["onClick"],z={key:0,class:"pinned-badge"},R={class:"post-date"},H={class:"post-excerpt"},U=["onClick"],W={__name:"ContentComponent",props:{posts:{type:Array,required:!0}},emits:["selectPost"],setup(a,{emit:c}){const e=c,r=p=>new Date(p).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),t=p=>{const i=p.replace(/#{1,6}\s+/g,"").replace(/```[\s\S]*?```/g,"").replace(/`([^`]+)`/g,"$1");return i.length>150?i.substring(0,150)+"...":i},l=p=>{e("selectPost",p)};return(p,i)=>(u(),m("div",q,[i[0]||(i[0]=o("h1",{style:{"font-family":"'SimSun', serif","font-size":"1.5em"}},"博客",-1)),o("div",E,[(u(!0),m(f,null,$(a.posts,s=>(u(),m("div",{key:s.id,class:"thought-item"},[o("div",V,[o("h2",{onClick:n=>l(s.id),class:"post-title"},_(s.title),9,F),s.pinned?(u(),m("span",z,"置顶")):k("",!0)]),o("p",R,_(r(s.date)),1),o("div",H,_(t(s.content)),1),o("button",{onClick:n=>l(s.id),class:"read-more"},"阅读全文",8,U)]))),128))])]))}},J=C(W,[["__scopeId","data-v-0cfa7026"]]),G={key:0,class:"blog-detail"},K={class:"post-content"},Q={class:"post-meta"},X={class:"post-date"},Y={class:"post-category"},Z={class:"post-tags"},tt=["innerHTML"],et={class:"comments-section"},st={class:"comment-form"},ot={class:"form-group"},nt={class:"form-group"},rt=["disabled"],at={class:"comments-list"},ct={key:0,class:"no-comments"},it={class:"comment-header"},lt={class:"comment-author"},dt={class:"comment-date"},ut={class:"comment-body"},mt={key:1,class:"loading"},pt={__name:"BlogDetailComponent",props:{post:{type:Object,required:!0},comments:{type:Array,default:()=>[]}},emits:["add-comment"],setup(a,{emit:c}){const e=a,r=c,t=g({author:"",content:""}),l=y(()=>{if(!e.post||!e.post.content)return"";let s=e.post.content;return s=s.replace(/^# (.*$)/gm,"<h1>$1</h1>"),s=s.replace(/^## (.*$)/gm,"<h2>$1</h2>"),s=s.replace(/^### (.*$)/gm,"<h3>$1</h3>"),s=s.replace(/^(?!<h[1-6]|```|$)(.*$)/gm,"<p>$1</p>"),s=s.replace(/```([\s\S]*?)```/gm,"<pre><code>$1</code></pre>"),s=s.replace(/`([^`]+)`/g,"<code>$1</code>"),s=s.replace(/^\- (.*$)/gm,"<li>$1</li>"),s=s.replace(/<\/li>\s*<li>/g,"</li><li>"),s=s.replace(/<li>(.*)<\/li>/g,"<ul>$&</ul>"),s}),p=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),i=()=>{t.value.content.trim()&&(r("add-comment",{author:t.value.author||"匿名用户",content:t.value.content.trim()}),t.value.content="")};return(s,n)=>a.post?(u(),m("div",G,[o("div",K,[o("h1",null,_(a.post.title),1),o("div",Q,[o("span",X,_(p(a.post.date)),1),o("span",Y,"分类："+_(a.post.category),1),o("div",Z,[n[2]||(n[2]=B(" 标签： ")),(u(!0),m(f,null,$(a.post.tags,d=>(u(),m("span",{key:d,class:"tag"},_(d),1))),128))])]),o("div",{class:"markdown-content",innerHTML:l.value},null,8,tt)]),o("div",et,[o("h2",null,"评论 ("+_(a.comments.length)+")",1),o("div",st,[n[5]||(n[5]=o("h3",null,"发表评论",-1)),o("div",ot,[n[3]||(n[3]=o("label",{for:"author"},"昵称：",-1)),P(o("input",{id:"author","onUpdate:modelValue":n[0]||(n[0]=d=>t.value.author=d),type:"text",placeholder:"请输入昵称"},null,512),[[D,t.value.author]])]),o("div",nt,[n[4]||(n[4]=o("label",{for:"content"},"评论内容：",-1)),P(o("textarea",{id:"content","onUpdate:modelValue":n[1]||(n[1]=d=>t.value.content=d),rows:"4",placeholder:"请输入评论内容..."},null,512),[[D,t.value.content]])]),o("button",{class:"submit-comment",onClick:i,disabled:!t.value.content.trim()}," 提交评论 ",8,rt)]),o("div",at,[a.comments.length===0?(u(),m("div",ct,"暂无评论，来发表第一条评论吧！")):k("",!0),(u(!0),m(f,null,$(a.comments,d=>(u(),m("div",{key:d.id,class:"comment-item"},[o("div",it,[o("span",lt,_(d.author),1),o("span",dt,_(p(d.date)),1)]),o("div",ut,_(d.content),1)]))),128))])])])):(u(),m("div",mt,"加载中..."))}},ht=C(pt,[["__scopeId","data-v-34ba02a1"]]);class _t{constructor(){this.dbName="blog-comments-db",this.storeName="comments",this.db=null}async openDatabase(){return new Promise((c,e)=>{if(this.db){c(this.db);return}const r=indexedDB.open(this.dbName,1);r.onupgradeneeded=t=>{const l=t.target.result;l.objectStoreNames.contains(this.storeName)||l.createObjectStore(this.storeName,{keyPath:"id"}).createIndex("by_postId","postId",{unique:!1})},r.onsuccess=t=>{this.db=t.target.result,c(this.db)},r.onerror=t=>{console.error("打开数据库失败:",t.target.error),e(t.target.error)}})}async getComments(c){try{const e=await this.openDatabase();return new Promise((r,t)=>{const s=e.transaction([this.storeName],"readonly").objectStore(this.storeName).index("by_postId").getAll(c);s.onsuccess=()=>{const n=s.result.sort((d,b)=>new Date(b.date)-new Date(d.date));r(n)},s.onerror=()=>{console.error("获取评论失败:",s.error),t(s.error)}})}catch(e){return console.error("获取评论失败:",e),[]}}async addComment(c,e){try{const r=await this.openDatabase(),t={id:Date.now().toString(),postId:c,content:e.content,author:e.author||"匿名用户",date:new Date().toISOString()};return new Promise((l,p)=>{const n=r.transaction([this.storeName],"readwrite").objectStore(this.storeName).add(t);n.onsuccess=()=>{l(t)},n.onerror=()=>{console.error("添加评论失败:",n.error),p(n.error)}})}catch(r){throw console.error("添加评论失败:",r),r}}}const S=new _t,vt=a=>S.getComments(a),gt=(a,c)=>S.addComment(a,c);function bt(a){const c=/---([\s\S]*?)---/,e=a.match(c);if(!e)return null;const r=e[1],t={};r.split(`
`).forEach(p=>{const[i,...s]=p.split(":").map(n=>n.trim());if(i&&s.length>0){const n=s.join(":");if(n.startsWith("[")&&n.endsWith("]"))try{t[i]=JSON.parse(n)}catch{if(i==="tags"){const d=n.slice(1,-1).trim();d?t[i]=d.split(",").map(b=>b.trim()):t[i]=[]}else t[i]=n}else t[i]=n.replace(/^['"]|['"]$/g,"")}});const l=a.replace(c,"").trim();return{...t,content:l,id:t.title?t.title.toLowerCase().replace(/\s+/g,"-"):"unknown"}}const yt=async()=>{try{const a=Object.assign({"/src/data/blog/first-blog.md":()=>x(()=>import("./first-blog-BVZuu_hh.js"),[]).then(e=>e.default),"/src/data/blog/tech-tips.md":()=>x(()=>import("./tech-tips-jy2ydpFm.js"),[]).then(e=>e.default)});return(await Promise.all(Object.entries(a).map(async([e,r])=>{const t=await r();return bt(t)}))).filter(e=>e!==null).sort((e,r)=>{const t=e.pinned===!0||e.pinned===1,l=r.pinned===!0||r.pinned===1;return t&&!l?-1:!t&&l?1:new Date(r.date)-new Date(e.date)})}catch(a){return console.error("Error loading blog posts:",a),[]}},ft=async a=>{try{return await Promise.resolve(vt(a))}catch(c){return console.error("获取评论失败:",c),[]}},$t=async(a,c)=>{try{return await Promise.resolve(gt(a,c))}catch(e){throw console.error("添加评论失败:",e),e}},Ct={class:"thought-container"},wt={key:0,class:"main-grid"},kt={class:"content-section"},Pt={key:0,class:"pagination"},Dt=["disabled"],xt={class:"pagination-info"},St=["disabled"],Nt={key:1,class:"post-detail"},At={__name:"BlogPage",setup(a){const c=g([]),e=g(null),r=g([]),t=g(1),l=g(5),p=y(()=>e.value&&c.value.find(h=>h.id===e.value)||null),i=y(()=>Math.ceil(c.value.length/l.value)),s=y(()=>{const h=(t.value-1)*l.value,v=h+l.value;return c.value.slice(h,v)}),n=h=>{h<1||h>i.value||(t.value=h)};I(async()=>{try{c.value=await yt()}catch(h){console.error("Failed to load blog posts:",h)}});const d=async h=>{e.value=h;try{r.value=await ft(h)}catch(v){console.error("Failed to load comments:",v),r.value=[]}},b=()=>{e.value=null},N=async h=>{if(!(!e.value||!h.content))try{const v=await $t(e.value,h);r.value.push(v)}catch(v){console.error("Failed to add comment:",v)}};return(h,v)=>(u(),m("div",Ct,[e.value?(u(),m("div",Nt,[o("button",{class:"back-button",onClick:b},"← 返回列表"),w(ht,{post:p.value,comments:r.value,onAddComment:N},null,8,["post","comments"])])):(u(),m("div",wt,[o("div",kt,[w(J,{posts:s.value,onSelectPost:d},null,8,["posts"]),i.value>1?(u(),m("div",Pt,[o("button",{class:"pagination-btn",onClick:v[0]||(v[0]=A=>n(t.value-1)),disabled:t.value===1}," 上一页 ",8,Dt),o("span",xt," 第 "+_(t.value)+" 页 / 共 "+_(i.value)+" 页 ",1),o("button",{class:"pagination-btn",onClick:v[1]||(v[1]=A=>n(t.value+1)),disabled:t.value===i.value}," 下一页 ",8,St)])):k("",!0)]),w(T,{posts:c.value,onSelectPost:d},null,8,["posts"])]))]))}},It=C(At,[["__scopeId","data-v-9bde192d"]]);export{It as default};
