import{i as O}from"./waterfall-IAql_oPo.js";import{_ as G,b as c,d,e as s,t as p,r as f,c as $,o as b,a as E,w as S,g as P,i as g,j as V,T as C,k as T,l as y,m as D,F as A,p as R}from"./index-CsJxBi-2.js";class x{constructor(t,a,n,r,o={}){this.id=t,this.path=a,this.description=n,this.tags=r,this.camera=o.camera||null,this.aperture=o.aperture||null,this.shutterSpeed=o.shutterSpeed||null,this.iso=o.iso||null,this.focalLength=o.focalLength||null}}const M=[{id:"1",url:"/assets/fig/photo-light.JPG",title:"山间日出",tags:["风景","自然"],cameraParams:{camera:"Canon EOS R5",aperture:"f/2.8",shutterSpeed:"1/125s",iso:"100",focalLength:"24mm"}},{id:"2",url:"/assets/fig/photo-dark.JPG",title:"城市夜景",tags:["夜景","城市"],cameraParams:{camera:"Sony A7R IV",aperture:"f/4.0",shutterSpeed:"10s",iso:"1600",focalLength:"28mm"}},{id:"3",url:"/assets/fig/photo-light.JPG",title:"古老建筑",tags:["旅行","建筑"],cameraParams:{camera:"Nikon Z7 II",aperture:"f/5.6",shutterSpeed:"1/60s",iso:"400",focalLength:"35mm"}},{id:"4",url:"/assets/fig/photo-dark.JPG",title:"传统美食",tags:["美食","文化"],cameraParams:{camera:"Fujifilm X-T4",aperture:"f/2.0",shutterSpeed:"1/100s",iso:"200",focalLength:"50mm"}},{id:"5",url:"/assets/fig/photo-light.JPG",title:"人像摄影",tags:["人像","生活"],cameraParams:{camera:"Canon EOS R6",aperture:"f/1.8",shutterSpeed:"1/250s",iso:"100",focalLength:"85mm"}},{id:"6",url:"/assets/fig/photo-dark.JPG",title:"星空摄影",tags:["夜景","自然"],cameraParams:{camera:"Sony A7S III",aperture:"f/2.8",shutterSpeed:"20s",iso:"6400",focalLength:"14mm"}}],F="YOUR_GOOGLE_API_KEY",B="YOUR_GOOGLE_DRIVE_FOLDER_ID";async function J(){return window.gapi||await new Promise((e,t)=>{const a=document.createElement("script");a.src="https://apis.google.com/js/api.js",a.onload=e,a.onerror=t,document.head.appendChild(a)}),new Promise((e,t)=>{window.gapi.load("client",async()=>{try{await window.gapi.client.init({apiKey:F,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),e()}catch(a){t(a)}})})}async function N(){try{await J();const t=(await window.gapi.client.drive.files.list({q:`'${B}' in parents and mimeType contains 'image/' and trashed = false`,fields:"files(id, name, description, mimeType, modifiedTime)",orderBy:"modifiedTime desc",pageSize:100})).result.files;return await Promise.all(t.map(async a=>{const n=`https://drive.google.com/uc?id=${a.id}&export=view`,r=a.description||a.name.replace(/\.[^/.]+$/,""),o=U(a.name);return new x(a.id,n,r,o)}))}catch(e){return console.error("Error fetching images from Google Drive:",e),L()}}function U(e){const t=e.split("_");if(t.length>1){const a=t[t.length-1],n=a.lastIndexOf(".");return n>0&&(t[t.length-1]=a.substring(0,n)),t.slice(1)}return[]}function L(){return M.map(e=>new x(e.id,e.url,e.title,e.tags,e.cameraParams))}const j=async()=>{try{const e=await N();return e&&e.length>0?e:L()}catch(e){return console.error("Error in getGalleryImages:",e),L()}},q={class:"camera-param"},K={class:"param-label"},Y={class:"param-value"},W={__name:"CameraParam",props:{label:{type:String,required:!0},value:{type:String,default:null}},setup(e){return(t,a)=>(c(),d("div",q,[s("span",K,p(e.label)+":",1),s("span",Y,p(e.value||"未知"),1)]))}},v=G(W,[["__scopeId","data-v-74c35edb"]]),z={class:"modal-layout"},X={class:"photo-section"},Z=["src","alt"],H={key:0,class:"loading-indicator"},Q={class:"info-section"},ee={class:"info-scroll-wrapper"},ae={class:"title-area"},te={class:"photo-title"},se={key:0,class:"image-index"},oe={class:"content-area"},le={class:"photo-description"},ne={class:"camera-area"},ie={class:"camera-params-list"},re={__name:"ImageModal",props:{modelValue:{type:Boolean,default:!1},image:{type:Object,required:!0},images:{type:Array,default:()=>[]}},emits:["update:modelValue","close","update:image"],setup(e,{emit:t}){const a=e,n=t,r=f(!1),o=$(()=>a.images.findIndex(l=>l.id===a.image.id)),h=()=>{_()},_=()=>{n("update:modelValue",!1),n("close")},w=()=>{if(a.images.length<=1)return;r.value=!0;const l=o.value===0?a.images.length-1:o.value-1;n("update:image",a.images[l])},I=()=>{if(a.images.length<=1)return;r.value=!0;const l=(o.value+1)%a.images.length;n("update:image",a.images[l])},k=()=>{r.value=!1},u=l=>{switch(["ArrowLeft","ArrowRight","Escape"].includes(l.key)&&l.preventDefault(),l.key){case"Escape":_();break;case"ArrowLeft":w();break;case"ArrowRight":I();break}};return b(()=>{a.modelValue&&document.addEventListener("keydown",u)}),E(()=>{document.removeEventListener("keydown",u),document.body.style.overflow=""}),S(()=>a.modelValue,l=>{l?(document.body.style.overflow="hidden",document.addEventListener("keydown",u),setTimeout(()=>{const i=document.querySelector(".modal-overlay");i&&i.focus()},100)):(document.body.style.overflow="",document.removeEventListener("keydown",u))}),S(()=>a.image,()=>{r.value=!0}),(l,i)=>(c(),P(T,{to:"body"},[g(C,{name:"modal"},{default:V(()=>[e.modelValue?(c(),d("div",{key:0,class:"modal-overlay",onClick:h},[s("div",{class:"modal-content",onClick:i[0]||(i[0]=D(()=>{},["stop"]))},[s("div",z,[s("div",X,[s("img",{src:e.image.path,alt:e.image.description,class:"modal-photo",onLoad:k},null,40,Z),r.value?(c(),d("div",H,i[1]||(i[1]=[s("div",{class:"spinner"},null,-1)]))):y("",!0)]),s("div",Q,[s("div",ee,[s("div",ae,[s("h3",te,p(e.image.description||"未命名照片"),1),e.images.length>1?(c(),d("div",se,p(o.value+1)+" / "+p(e.images.length),1)):y("",!0)]),s("div",oe,[s("p",le,p(e.image.description||"暂无描述"),1)]),s("div",ne,[i[2]||(i[2]=s("h4",{class:"camera-title"},"相机参数",-1)),s("div",ie,[g(v,{label:"相机",value:e.image.camera},null,8,["value"]),g(v,{label:"光圈",value:e.image.aperture},null,8,["value"]),g(v,{label:"快门",value:e.image.shutterSpeed},null,8,["value"]),g(v,{label:"ISO",value:e.image.iso},null,8,["value"]),g(v,{label:"焦距",value:e.image.focalLength},null,8,["value"])])])])])])])])):y("",!0)]),_:1})]))}},ce=G(re,[["__scopeId","data-v-d6ae6ab6"]]),de={class:"gallery-container"},ue={id:"waterfall-container"},me=["onClick"],ge={class:"image-wrapper"},pe=["src","alt"],he={key:0,class:"loading"},ve={__name:"GalleryPage",setup(e){const t=f([]),a=f(!0),n=f(null),r=f(!1);let o=null,h=0;const _=()=>{h++,h===t.value.length&&(w(),a.value=!1)},w=()=>{o&&o.destroy(),o=O("#waterfall-container",".gallery-item")},I=l=>{n.value=l,r.value=!0},k=()=>{n.value=null},u=l=>{n.value=l};return b(async()=>{try{a.value=!0,h=0,t.value=await j(),t.value.length===0&&setTimeout(()=>{a.value=!1},1e3)}catch(l){console.error("Error loading gallery:",l),a.value=!1}}),E(()=>{o&&(o.destroy(),o=null),document.body.style.overflow=""}),(l,i)=>(c(),d("div",de,[i[1]||(i[1]=s("h1",null,"Gallery",-1)),s("div",ue,[(c(!0),d(A,null,R(t.value,m=>(c(),d("div",{key:m.id,class:"gallery-item",onClick:fe=>I(m)},[s("div",ge,[s("img",{src:m.path,alt:m.description,class:"gallery-image",onLoad:_},null,40,pe)])],8,me))),128)),a.value?(c(),d("div",he,"加载中...")):y("",!0)]),n.value?(c(),P(ce,{key:0,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=m=>r.value=m),image:n.value,images:t.value,onClose:k,"onUpdate:image":u},null,8,["modelValue","image","images"])):y("",!0)]))}},we=G(ve,[["__scopeId","data-v-de5c98d3"]]);export{we as default};
